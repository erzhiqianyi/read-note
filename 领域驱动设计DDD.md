# 领域驱动设计DDD

## 领域驱动设计的原则和实践

### 什么是领域驱动设计？

- 目标

	- 理解领域驱动设计

		- 原则
		- 实践
		- 模式

	- 分析问题空间的重要性
	- 维护软件的重要技能

		- 合作
		- 交流
		- 上下文

- 复杂领域问题带来的挑战

	- 大泥球架构的问题

		- 杂乱无序
		- 面条式的代码
		- 可以工作，但是不明所以

	- 软件复杂的原因

		- 代码实现和业务分析缺乏共同语言

			- 代码没有展现业务意图
			- 分析模型和最终代码没有保持一致

				- 实际操作上可能没有分析模型，得到需求后直接写代码

			- 代码难以阅读和维护

		- 缺乏组织

			- 混乱的代码影响项目进度
			- 容易产生bug

		- 问题域分析不足

			- 问题域是什么？

				- 软件要解决的问题
				- 业务专家和工程师的共识
				- 示例

					- 记录病人治疗的软件

						- 医疗行业专业术语
						- 不同部门如何看病人
						- 医生需要收集什么信息
						- 医生用这些信息做什么

			- 分析问题域为何能降低复杂度？

				- 领域驱动的战略模式，分割解决方案

					- 提炼问题域，找出问题的重点，拆分成更小的问题域
					- 创建模型解决领域问题
					- 使用共同语言完成建模协作
					- 消除模型中的歧义和问题
					- 区分上下文之间的关系

				- 领域驱动的战术模式，实现领域

					- 问题空间
					- 解决空间

- 设计原则和实践

	- 专注于主要领域

		- 软件的价值所在
		- 团队成员必须理解

	- 通过合作学习

		- 业务专家和开发人员互相学习

	- 通过探索和实验构建模型
	- 交流

		- 达成交流的基础：共同语言

	- 理解模型的适用范围
	- 持续改善模型

- 常见的错误观念

	- 战术模式是DDD的关键
	- DDD是一个框架
	- DDD是银弹

### 提炼问题域

- 目标

	- 掌握提炼问题域的方法

- 方法

	- 知识消化和交流

		- 角色

			- 从使用场景开始
			- 业务专家
			- 开发团队

		- 使用共同语言达成共识

			- 共同语言

				- 各方都能理解
				- 明确
				- 描述问题和编程实现时都能使用

		- 理解领域知识

			- 达到用简单术语描述问题

		- 重视业务分析
		- 持续提炼

	- 通过领域专家获得领域认实

		- 领域专家

			- 构建领域模型满足业务和程序的需求

		- 业务需求方

			- 注重需要需要实现得功能

		- 深入理解业务
		- 和领域专家互动

	- 对知识进行提炼压缩

		- 专注于有趣的部分
		- 从使用场景开始
		- 问有用的问题
		- 想法可视化

			- 使用简单图表
			- uml语言
			- 类职责交流卡片

				- 类名
				- 类职责
				- 关联的和实现其目的所需要的类

			- 定义模型名字

		- 行为驱动开发，BDD 

			- 专注于软件行为，软件需要做什么
			- Given
			- When
			- Then

		- 快速形成原型

	- 查看已经存在的模型

		- 理解意图

			- 深入理解用户需求，用户可能基于当前系统提出需求，而不是真正需求

		- 活动风暴

			- 帮助快速理解领域问题
			- 开发团队：提问题
			- 领域专家：回答问题

		- 影响映射，分析需求带来的影响

			- 从整体考虑需求带来的影响

				- 业绩收益
				- 系统影响

			- 提出自己的想法和建议

		- 理解业务模型

			- 使用业务模型卡片：Business Model Canvas

### 专注于主要领域

- 目标

	- 理解拆分领域问题的重要性
	- 如何找出并专注于核心领域
	- 如何实现通用领域
	- 合理设计的重要性，区分主次

- 问题

	- 为什么问题域会变糟糕？

		- 系统越大，越复杂，不是所有功能都一样重要

- 如何找出核心领域

	- 什么是核心领域

		- 系统最有价值的部分

	- 从长远的角度看需求

	  用户会想要一匹更快的马

	- 分析领域问题时尽量不要考虑技术细节
	- 拆分领域问题

		- 核心领域

			- 哪一部分决定产品的成败
			- 把核心领域当初产品

		- 通用领域

			- 通用业务的领域

				- 发送邮件服务

		- 支持领域

			- 支持核心领域

- 通过子领域合作形成解决方案
- 不是所有领域都同等重要

	- 区分领域边界
	- 核心领域不一定一开始就达到完美
	- 新建领域而不要尝试代替遗留领域

### 模型驱动设计

- 目标

	- 什么是领域模型
	- 理解通用语言的重要性
	- 如何用通用语言改善沟通和协作
	- 正确的应用来领域驱动设计
	- 如果创建有效的模型
	- 使用通用语言绑定分析模型和代码模型

- 领域模型

	- 领域和领域模型的区别

		- 领域

			- 需要解决的问题
			- 现实问题

		- 领域模型

			- 问题域的抽象
			- 用视图表示的代码实现
			- 帮助解决当前问题
			- 不涉及技术细节

	- 分析模型

		- 描述系统模型的集合
		- 帮助理解问题领域
		- 不是技术实现的蓝图

	- 代码模型

		- 代码模型是领域模型的重要表达
		- 和业务同步

- 模型驱动设计

	- 将分析模型和代码实现绑定的过程
	- 注重实现
	- 前期设计的挑战

		- 代码实现和分析模型脱钩
		- 要求全团队进行合作
		- 团队信息要同步

	- 如何实现模型驱动设计

		- 使用通用语言绑定分析模型和代码模型
		- 基于通用语言交流合作

			- 开发人员

				- 技术抽象
				- 设计模式
				- 设计原则
				- 考虑领域术语和概念

			- 领域专家

				- 业务处理
				- 工作流

		- 通过示例来优化通用语言
		- 让领域专家专注于问题而非提供解决方案
		- 优化通用语言

			- 确保语言一致，领域专家和开发人员都能理解
			- 和领域专家确术语表
			- 维持同一个事务只有一个术语
			- 尽量避免通用词语

				- service
				- manager
				- policy

			- 尽量避免使用技术领域专业术语

				- 设计模式

			- 良好的命名
			- 根据通用语言命名例外
			- 通用语言要有语义性

	- 什么时候使用模型驱动设计

		- 简单问题可以不用模型化
		- 专注于核心问题

	- 如何高效创建领域模型

		- 专注于核心领域

			- 模型数据结构
			- 有什么操作

		- 不要让真相成为榜样

			- 领域模型是对现实的抽象而非镜像

		- 仅为相关内容建模
		- 模型只是为当时需求建模，与业务保持同步
		- 明确专用术语
		- 合理抽象

			- 通过领域即可理解领域概念，不必深入代码
			- 抽象行为不是实现

		- 尽早用代码实现模型
		- 尽可能想更多实现方案

### 领域模型实现模式

- 目标

	- 理解领域层的作用
	- 掌握实现领域模型的模式
	- 如何选择正确的设计模式

- 领域层

	- 定义

		- 包含领域模型部分的代码

	- 特点

		- 讲领域模型的负责性和应用程序的技术复杂性隔离
		- 确保基础设施不会渗入业务问题

			- 基础设施

				- 事务管理
				- 持久化

	- 实现模式

		- 领域模型

			- 是对象

				- 行为
				- 数据

			- 前提条件

				- 没有数据库，不需要持久化

			- 从代码模型开始，而非数据模型

				- 和数据模型驱动相反

		- 交易脚本

			- 过程化
			- 适用于没有业务逻辑或业务逻辑较少

		- 表模型

			- 映射到数据库

		- 贫血模型

			- 领域对象仅仅是数据传输对象
			- 领域服务处理业务逻辑
			- 适用于没有业务逻辑或业务逻辑较少

### 通过上下文边界维护领域的完整性

- 目标

	- 理解单一模型带来的挑战
	- 理解上下文边界的重要性
	- 掌握找出上下文边界的方法
	- 保护合谐领域的完整性
	- 掌握使用上下文边界的条件

- 为什们要有上下文边界

	- 单一模型带来的挑战

		- 业务变更，模型会变得复杂
		- 多个团队共用一个模型
		- 模型语言带来歧义。同一术语在不同模型中意义可能不一样
		- 不同领域有不同的适用范围，单一模型职责太多

	- 区分模型边界，可降低复杂度
	- 领域模型不是企业模型

- 什么是上下分边界

	- 定义领域的适用范围

		- 领域用来做什么
		- 哪些范围需要保持一致
		- 哪些部分需要忽略

- 划分上下文边界

	- 根据技术划分
	- 根据业务划分
	- 影响上下文边界的因素

		- 领域中术语和概念的歧义
		- 与子领域和业务保持一致
		- 团队组织和物理位置
		- 遗留代码
		- 第三方集成

	- 方法

		- 定义语言边界

			- 与领域专家交谈时，确保上下文明确
			- 如果一个概念在同一个模型里有不同意义，考虑拆分成多个上下文

		- 与业务能力保持一致
		- 为团队创建上下文
		- 保持团队间的交流

- 子领域和上下文边界的区别

	- 子领域

		- 区分应用的重要部分
		- 提炼问题域，降低复杂度

	- 上下文边界

		- 用来实现模型边界的具体技术1
		- 存在于解决域

- 建议

	- 团队协作时，确保成员都明白领域上下文
	- 把上下分边界当作国界

### 映射上下文

- 目标

	- 理解上下文映射在战略设计中的重要性
	- 理解模型在上下文边界中的关系
	- 掌握团队及上下文之间的组织关系模式
	- 如何高效传递上下文映射

- 现实的映射

	- 特点

		- 确保系统各个上下文的边界定义清晰
		- 每个团队都能理解其中的关系
		- 不是详细的文档
		- 足够简单

	- 技术事实

		- 强调上下文之间的整合
		- 技术如何影响应用整合
		- 应用的当前状态
		- 各个上下文之间的联络点以及数据的流动
		- 和代码保持同步

	- 组织事实

## 通过战略模式在上下文之间交流

## 通过战术模式高效创建领域模型

## 有效应用的设计模式

## 

*XMind - Trial Version*
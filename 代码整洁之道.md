# 代码整洁之道

## 整洁代码

### 评价标准

- 代码审查时：WTF尽量少

### 代码质量

- 坏代码

	- 降低生产力

- 整洁代码

	- 保持快速增长的唯一方式

### 定义

- c++之父 :Jarne Stroustrup

	- 优美，高效

		- 逻辑简明
		- 依赖最小化
		- 合理的异常处理
		- 高效

- 程序员修炼之道作者：Dave Thomas and Andy Hunt

	- 不是破窗

		- 不会引起坏的连锁反应

- 面向对象分析与设计作者：Grady Booch:

	- 简单，直接，像优美的散文

		- 可读性好
		- 抽象适当

- Eclipse 战略教父

	- 可读性好，经得起测试

		- 不仅原作者能看懂，别人也能看懂
		- 有单元测试和验收测试
		- 有意义的名字
		- 一件事情提供一种解决方案，而非多种
		- 依赖最小化
		- 干净和最小化的接口

- 修改代码的艺术作者：Michael Feathers

	- 深思熟虑的代码，好到难以优化

		- 花时间让代码保持简单，有序

- 极限编程发起人：Ron Jeffries

	- 有序，简单，有表现力

		- 通过所有测试
		- 没有任何重复
		- 展现出系统所有的设计理念
		- 入口最小花化，如类，方法，函数

- Wiki发明人：Ward Cunningham

	- 你读的和你期待的一样

- 代码简洁之道作者：Uncel Bob Martin

	- 整洁变量命名
	- 整洁函数

## 原则

### 有意义的命名

- 名副其实，表达意义

	- 细则

		- 为什么存在
		- 用来做什么
		- 怎么使用
		- 最好不需要注释

	- 示例

		- 表示时间

			- int  day //elpaese tim e in day 
			- int eplapeseTimeInDays
			- int fileAgeInDays
			- int daySinceCrateion
			- int daySinceModifition

- 避免误导

	- 细则

		- 避免留下掩藏代码本意的错误线索
		- 避免使用和本意相悖的词
		- 使用一致的拼写
		- 使用辨识度高的字体

	- 示例

		- accountList
		- accounts
		- accountGroup
		- ganchOfAcount

- 做有意义的区分

	- 细则

		- 同一类型不同东西要有区分度
		- 不用使用数字或错误的拼写来区分

	- 示例

		- 典型的噪音命名

			- Info
			- Data
			- A
			- The
			- Name
			- Object

		- 没有区分度的命名

			- void copyChars(char a[] ,char b[] )
			- void copyChars(char source[] ,char target[] )
			- getActiveAccount()
			- getActiveAccounts()

- 使用能读出来的发音

	- 无法读出来，就无法交流

- 使用可检索的名字

	- 细则

		- 单字母名称最好用在局部变量
		- 名字的长度和作用域成正比

- 避免使用编码

	- 增加皮衣的负担
	- 成员变量没必要添加前缀
	- 接口保持接口原意，实现添加Imp后缀

- 避免思维映射

	- 不需要转换就能理解
	- 使用通用意义的单词，如i，j 

- 类和方法

	- 类尽量使用名词，Customer
	- 方法尽量使用动词，postPayMent()

- 意义准确

	- 用清晰而非娱乐性的词
	- 同样的概念用一个词，避免混乱
	- 不要用双关语

- 和领域相关

	- 使用技术性的词语
	- 使用来自领域问题的词语

- 合理的上下文

	- 添加有意义的上下文
	- 不要添加没有理由的上下文

### 整洁的函数

- 原则

	- 让函数变小
	- 让函数变得更小
	- 保持在100行以内
	- 只做一件事情，并做好
	- 只有一个抽象层级
	- 块和缩进

		- 缩进不要两次
		- 语法块自成一行

	- 自顶向下原则，自顶向下阅读不影响理解
	- 名字自解释，保持和内容一致
	- 不要重复自己

- 实践

	- 使用多态代替switch语句
	- 函数参数尽量少

		- 参数多时使用对象封装
		- 尽量不要使用标志参数
		- 函数名和参数相匹配

	- 命令分离

		- 做什么
		- 回答什么

	- 抛出异常而不是返回错误代码
	- try cache 分离出来，cache中的代码不要太多，如果代码多，放到单独的方法里处理

### 合适的注释

- 原则

	- 不要为糟糕的代码写注释，重写它
	- 如无必要，尽量不要写注释，让代码自解释
	- 代码才是唯一的真相

- 实践

	- 及时维护旧的注释
	- 好的注释

		- 合法的注释，如版权，作者
		- 提供有用信息的注释
		- 解释意图
		- 澄清事实
		- 提醒别人要注意的地方
		- todo 提醒
		- 加强提示
		- 良好的java doc

	- 坏的注释

		- 含糊不清的注释
		- 多余的注释
		- 误导性的注释
		- 任务式的注释
		- 日报，周报式的注释
		- 噪音注释
		- 位置，区块标记
		- 代码归属注释
		- 被注释的代码
		- html注释
		- 注释和代码无关系
		- 非public地方的java doc 
		- 不明显的连接

### 优美的格式

- 格式的作用

	- 让代码变得干净
	- 促进交流

- 原则

	- 垂直方向

		- 源文件大小，最好不要超过500行
		- 不同概念之间分离
		- 相关性的聚合
		- 局部变量尽量在使用的地方声明
		- 实例变量放在顶部
		- 有调用关系的函数放在一起
		- 自顶向下

	- 水平方向

		- 长度：尽量短，最好不要超过120个字符
		- 相关的放在一起
		- 没必要做成表格形式排版
		- 缩进：区分从属关系
		- 避免空循环

- 实践

	- 团队确定规则，统一风格

### 合理使用对象和数据结构

- 原则

	- 数据抽象

		- 隐藏内部实现
		- 提供抽象接口操作内部数据
		- 不能简单使用getter和setter暴露内部实现

	- 反对称性

		- 对象：隐藏数据实现，提供接口操作数据
		- 数据结构：暴漏数据，没有操作

	- 迪米特原则：一个类对其他类之道的越少越好

		- 对象隐藏内部实现
		- 函数不应该调用任何函数返回的对象的方法

- 实践

	- 避免混合数据结构和对象
	- 数据传输对象Dto,只做数据结构

### 优雅的异常处理

- 使用异常二非错误码
- 处理受检查异常，最好不要一路往上抛
- 为异常提供上下文

	- 错误的源头和位置
	- 提供有误的错误信息

		- 业务参数
		- 业务类型

- 包装异常
- 定义正常的业务流程
- 不要返回null
- 不要传第null

